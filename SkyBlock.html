<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SkyBlock Clicker RPG</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: #1a1a1a;
            --card-color: #2a2a2a;
            --text-color: #ffffff;
            --accent-color: #4caf50;
            --secondary-color: #2196f3;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        /* –®–∞–ø–∫–∞ —Å–æ —Å—Ç–∞—Ç–∞–º–∏ */
        #header {
            padding: 15px;
            background: var(--card-color);
            display: flex;
            justify-content: space-around;
            border-bottom: 2px solid #333;
            font-weight: bold;
        }

        /* –û—Å–Ω–æ–≤–Ω–∞—è –∏–≥—Ä–æ–≤–∞—è –∑–æ–Ω–∞ */
        #game-screen {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            text-align: center;
        }

        .location-box {
            background: var(--card-color);
            padding: 20px;
            border-radius: 15px;
            width: 100%;
            max-width: 400px;
            min-height: 200px;
            display: none;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }

        .location-box.active { display: block; }

        /* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π */
        .action-btn {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 18px;
            cursor: pointer;
            margin: 10px;
            width: 80%;
            transition: transform 0.1s;
        }

        .action-btn:active { transform: scale(0.95); }
        .action-btn:disabled { background: #555; }

        /* –ù–∏–∂–Ω–µ–µ –º–µ–Ω—é */
        #nav-bar {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            background: var(--card-color);
            padding: 10px 5px;
            gap: 5px;
        }

        .nav-btn {
            background: none;
            border: none;
            color: #aaa;
            font-size: 10px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .nav-btn.active { color: var(--accent-color); }
        .nav-btn i { font-size: 20px; margin-bottom: 5px; }

        /* –õ–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π */
        #log {
            font-size: 14px;
            color: #888;
            margin-top: 15px;
            height: 40px;
        }
    </style>
</head>
<body>

    <div id="header">
        <div>üí∞ <span id="coins">0</span></div>
        <div>üåü LVL <span id="lvl">1</span></div>
        <div>‚ö° XP <span id="xp">0</span></div>
    </div>

    <div id="game-screen">
        <!-- –ì–ª–∞–≤–Ω–∞—è –∫–æ–º–Ω–∞—Ç–∞ / –î–æ–º -->
        <div id="home" class="location-box active">
            <h2>–¢–≤–æ–π –î–æ–º</h2>
            <p>–ó–¥–µ—Å—å —Ç—ã –º–æ–∂–µ—à—å –æ—Ç–¥–æ—Ö–Ω—É—Ç—å –∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–≤–æ–∏ —Ä–µ—Å—É—Ä—Å—ã.</p>
            <div id="inventory-list" style="text-align: left; margin: 0 auto; display: inline-block;"></div>
        </div>

        <!-- –®–∞—Ö—Ç–∞ -->
        <div id="mine" class="location-box">
            <h2>–®–∞—Ö—Ç–∞</h2>
            <button class="action-btn" onclick="game.mine()">–ö–æ–ø–∞—Ç—å —Ä—É–¥—É</button>
        </div>

        <!-- –§–µ—Ä–º–∞ -->
        <div id="farm" class="location-box">
            <h2>–§–µ—Ä–º–∞</h2>
            <div id="farm-status">–ì—Ä—è–¥–∫–∞ –ø—É—Å—Ç–∞</div>
            <button id="farm-btn" class="action-btn" onclick="game.farmAction()">–ü–æ—Å–∞–¥–∏—Ç—å</button>
        </div>

        <!-- –†—ã–±–∞–ª–∫–∞ -->
        <div id="fishing" class="location-box">
            <h2>–û–∑–µ—Ä–æ</h2>
            <div id="fish-status">–í–æ–¥–∞ —Å–ø–æ–∫–æ–π–Ω–∞...</div>
            <button id="fish-btn" class="action-btn" onclick="game.fishAction()">–ó–∞–±—Ä–æ—Å–∏—Ç—å —É–¥–æ—á–∫—É</button>
        </div>

        <!-- –õ–µ—Å–æ—Ä—É–±—Å—Ç–≤–æ -->
        <div id="wood" class="location-box">
            <h2>–õ–µ—Å</h2>
            <button class="action-btn" onclick="game.chop()">–†—É–±–∏—Ç—å –¥–µ—Ä–µ–≤–æ</button>
        </div>

        <!-- –î–∞–Ω–∂–∏ -->
        <div id="dungeon" class="location-box">
            <h2>–î–∞–Ω–∂</h2>
            <p>–ú–æ–Ω—Å—Ç—Ä—ã –∑–¥–µ—Å—å –æ–ø–∞—Å–Ω—ã!</p>
            <button class="action-btn" onclick="game.attack()">–ê—Ç–∞–∫–æ–≤–∞—Ç—å</button>
        </div>

        <div id="log">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ SkyBlock!</div>
    </div>

    <nav id="nav-bar">
        <button class="nav-btn active" onclick="game.switchTab('home', this)">üè†<br>–î–æ–º</button>
        <button class="nav-btn" onclick="game.switchTab('mine', this)">‚õèÔ∏è<br>–®–∞—Ö—Ç–∞</button>
        <button class="nav-btn" onclick="game.switchTab('farm', this)">üåæ<br>–§–µ—Ä–º–∞</button>
        <button class="nav-btn" onclick="game.switchTab('fishing', this)">üé£<br>–†—ã–±–∞–ª–∫–∞</button>
        <button class="nav-btn" onclick="game.switchTab('wood', this)">ü™ì<br>–õ–µ—Å</button>
    </nav>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        const game = {
            // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
            state: {
                coins: 0,
                xp: 0,
                lvl: 1,
                inventory: {
                    stone: 0,
                    wheat: 0,
                    fish: 0,
                    wood: 0
                }
            },

            // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –º–µ—Ö–∞–Ω–∏–∫
            farmState: 'empty', // empty, growing, ready
            fishState: 'idle',  // idle, waiting, biting
            fishTimer: null,

            init() {
                // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–π
                const saved = localStorage.getItem('skyblock_save');
                if (saved) {
                    this.state = JSON.parse(saved);
                }
                this.updateUI();
                this.log("–ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞");
            },

            save() {
                localStorage.setItem('skyblock_save', JSON.stringify(this.state));
            },

            updateUI() {
                document.getElementById('coins').innerText = this.state.coins;
                document.getElementById('xp').innerText = this.state.xp;
                document.getElementById('lvl').innerText = this.state.lvl;
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è –≤ –¥–æ–º–µ
                const inv = document.getElementById('inventory-list');
                inv.innerHTML = `
                    üåë –ö–∞–º–µ–Ω—å: ${this.state.inventory.stone}<br>
                    üåæ –ü—à–µ–Ω–∏—Ü–∞: ${this.state.inventory.wheat}<br>
                    üêü –†—ã–±–∞: ${this.state.inventory.fish}<br>
                    ü™µ –î–µ—Ä–µ–≤–æ: ${this.state.inventory.wood}
                `;
            },

            log(msg) {
                document.getElementById('log').innerText = msg;
            },

            addXP(amount) {
                this.state.xp += amount;
                if (this.state.xp >= this.state.lvl * 100) {
                    this.state.xp = 0;
                    this.state.lvl++;
                    this.log("–£—Ä–æ–≤–µ–Ω—å –ø–æ–≤—ã—à–µ–Ω!");
                    tg.HapticFeedback.notificationOccurred('success');
                }
                this.updateUI();
                this.save();
            },

            switchTab(tabId, btn) {
                // –°–º–µ–Ω–∞ —ç–∫—Ä–∞–Ω–æ–≤
                document.querySelectorAll('.location-box').forEach(b => b.classList.remove('active'));
                document.getElementById(tabId).classList.add('active');
                
                // –°–º–µ–Ω–∞ –∞–∫—Ç–∏–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏ –≤ –º–µ–Ω—é
                document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                tg.HapticFeedback.impactOccurred('light');
            },

            // --- –ú–ï–•–ê–ù–ò–ö–ê –®–ê–•–¢–´ ---
            mine() {
                this.state.inventory.stone++;
                this.state.coins += 2;
                this.addXP(10);
                this.log("+1 –ö–∞–º–µ–Ω—å");
                tg.HapticFeedback.impactOccurred('medium');
            },

            // --- –ú–ï–•–ê–ù–ò–ö–ê –õ–ï–°–ê ---
            chop() {
                this.state.inventory.wood++;
                this.state.coins += 2;
                this.addXP(10);
                this.log("+1 –î–µ—Ä–µ–≤–æ");
                tg.HapticFeedback.impactOccurred('medium');
            },

            // --- –ú–ï–•–ê–ù–ò–ö–ê –§–ï–†–ú–´ ---
            farmAction() {
                const btn = document.getElementById('farm-btn');
                const status = document.getElementById('farm-status');

                if (this.farmState === 'empty') {
                    this.farmState = 'growing';
                    status.innerText = "–†–∞—Å—Ç—ë—Ç...";
                    btn.disabled = true;
                    
                    setTimeout(() => {
                        this.farmState = 'ready';
                        status.innerText = "–°–æ–∑—Ä–µ–ª–æ!";
                        btn.innerText = "–°–æ–±—Ä–∞—Ç—å —É—Ä–æ–∂–∞–π";
                        btn.disabled = false;
                        this.log("–£—Ä–æ–∂–∞–π –≥–æ—Ç–æ–≤ –∫ —Å–±–æ—Ä—É");
                    }, 3000); // –†–∞—Å—Ç–µ—Ç 3 —Å–µ–∫—É–Ω–¥—ã
                } 
                else if (this.farmState === 'ready') {
                    this.state.inventory.wheat += Math.floor(Math.random() * 3) + 1;
                    this.state.coins += 5;
                    this.addXP(20);
                    this.farmState = 'empty';
                    status.innerText = "–ì—Ä—è–¥–∫–∞ –ø—É—Å—Ç–∞";
                    btn.innerText = "–ü–æ—Å–∞–¥–∏—Ç—å";
                    this.log("–£—Ä–æ–∂–∞–π —Å–æ–±—Ä–∞–Ω!");
                }
            },

            // --- –ú–ï–•–ê–ù–ò–ö–ê –†–´–ë–ê–õ–ö–ò ---
            fishAction() {
                const btn = document.getElementById('fish-btn');
                const status = document.getElementById('fish-status');

                if (this.fishState === 'idle') {
                    this.fishState = 'waiting';
                    status.innerText = "–ñ–¥—ë–º –∫–ª—ë–≤–∞...";
                    btn.innerText = "–ñ–¥–∏...";
                    btn.disabled = true;

                    // –°–ª—É—á–∞–π–Ω–æ–µ –≤—Ä–µ–º—è –¥–æ –ø–æ–∫–ª–µ–≤–∫–∏ (2-5 —Å–µ–∫)
                    const waitTime = 2000 + Math.random() * 3000;
                    this.fishTimer = setTimeout(() => {
                        this.fishState = 'biting';
                        status.innerText = "–ö–õ–Æ–Å–¢! –ü–û–î–°–ï–ö–ê–ô!";
                        btn.innerText = "–ü–û–î–°–ï–ß–¨!";
                        btn.disabled = false;
                        btn.style.background = "#f44336";

                        // –î–∞–µ–º 1.5 —Å–µ–∫—É–Ω–¥—ã –Ω–∞ —Ä–µ–∞–∫—Ü–∏—é
                        this.fishTimer = setTimeout(() => {
                            if (this.fishState === 'biting') {
                                this.resetFishing("–†—ã–±–∞ —Å–æ—Ä–≤–∞–ª–∞—Å—å...");
                            }
                        }, 1500);
                    }, waitTime);
                } 
                else if (this.fishState === 'biting') {
                    clearTimeout(this.fishTimer);
                    this.state.inventory.fish++;
                    this.state.coins += 15;
                    this.addXP(30);
                    this.resetFishing("–ü–æ–π–º–∞–ª —Ä—ã–±—É!");
                    tg.HapticFeedback.notificationOccurred('success');
                }
            },

            resetFishing(msg) {
                const btn = document.getElementById('fish-btn');
                const status = document.getElementById('fish-status');
                this.fishState = 'idle';
                status.innerText = "–í–æ–¥–∞ —Å–ø–æ–∫–æ–π–Ω–∞...";
                btn.innerText = "–ó–∞–±—Ä–æ—Å–∏—Ç—å —É–¥–æ—á–∫—É";
                btn.style.background = "var(--accent-color)";
                this.log(msg);
            },

            // --- –ú–ï–•–ê–ù–ò–ö–ê –î–ê–ù–ñ–ê (–£–ü–†–û–©–ï–ù–ù–û) ---
            attack() {
                if (Math.random() > 0.3) {
                    this.state.coins += 50;
                    this.addXP(50);
                    this.log("–ú–æ–Ω—Å—Ç—Ä –ø–æ–±–µ–∂–¥–µ–Ω! +50 –º–æ–Ω–µ—Ç");
                } else {
                    this.log("–ú–æ–Ω—Å—Ç—Ä —É–¥–∞—Ä–∏–ª —Ç–µ–±—è! –¢—ã —É–±–µ–∂–∞–ª.");
                }
                tg.HapticFeedback.impactOccurred('heavy');
            }
        };

        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
        game.init();
    </script>
</body>
</html>