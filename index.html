<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hypixel SkyBlock Clicker</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg: #0b0b0d;
            --card: #16161a;
            --accent: #ffaa00;
            --blue: #5555ff;
            --red: #ff5555;
            --gray: #aaaaaa;
            --white: #ffffff;
            --rarity0: #ffffff; --rarity1: #55ff55; --rarity2: #55ffff; --rarity3: #aa00aa; --rarity4: #ffaa00;
        }

        body {
            margin: 0; padding: 0; background: var(--bg); color: var(--white);
            font-family: 'Courier New', Courier, monospace; /* –í —Å—Ç–∏–ª–µ –º–∞–π–Ω–∫—Ä–∞—Ñ—Ç–∞ */
            display: flex; flex-direction: column; height: 100vh; overflow: hidden;
        }

        /* HEADER (HOME) */
        #header-ui {
            padding: 10px 15px; display: flex; justify-content: space-between; align-items: center;
            background: rgba(0,0,0,0.5); border-bottom: 2px solid #333;
        }
        .sb-lvl-badge { color: var(--accent); font-weight: bold; font-size: 1.1rem; }
        .top-btn { background: #333; border: 1px solid #555; color: white; padding: 6px 10px; border-radius: 4px; font-size: 0.8rem; }

        /* SCREENS */
        #viewport { flex: 1; overflow-y: auto; padding: 15px; padding-bottom: 80px; }
        .screen { display: none; }
        .screen.active { display: block; }

        /* CARDS */
        .card { background: var(--card); border: 2px solid #333; padding: 15px; margin-bottom: 10px; border-radius: 2px; }
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 0.9rem; }
        .stat-val { color: var(--red); }

        /* PORTAL GRID */
        .portal-container { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .portal-node { 
            background: #222; border: 2px solid #444; padding: 15px; text-align: center; 
            border-radius: 8px; cursor: pointer; transition: 0.2s;
        }
        .portal-node:active { transform: scale(0.95); background: #333; }

        /* INVENTORY */
        .inv-cats { display: flex; gap: 5px; overflow-x: auto; margin-bottom: 10px; scrollbar-width: none; }
        .cat-btn { background: #222; border: 1px solid #444; color: #888; padding: 5px 10px; white-space: nowrap; border-radius: 4px; }
        .cat-btn.active { border-color: var(--accent); color: var(--white); }
        .item-card { 
            background: #111; border-left: 4px solid var(--white); padding: 10px; 
            margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center;
        }

        /* NAV */
        #nav { 
            position: fixed; bottom: 0; width: 100%; height: 70px;
            background: #1c1c1c; display: grid; grid-template-columns: repeat(4, 1fr);
            border-top: 3px solid #333;
        }
        .nav-item { 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: #666; font-size: 0.7rem; text-decoration: none; border: none; background: none;
        }
        .nav-item.active { color: var(--accent); }
        .nav-item i { font-size: 1.5rem; margin-bottom: 4px; }

        /* MODALS */
        .modal { 
            display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); 
            z-index: 1000; padding: 20px; overflow-y: auto;
        }
        .close-modal { float: right; color: var(--red); font-weight: bold; }

        .progress-wrap { background: #333; height: 12px; border: 1px solid #555; margin-top: 5px; }
        .progress-fill { height: 100%; background: var(--blue); width: 0%; transition: 0.3s; }
    </style>
</head>
<body>

    <div id="header-ui">
        <button class="top-btn" onclick="game.showModal('skillsModal')">‚ò∞ –°–∫–∏–ª–ª—ã</button>
        <div class="sb-lvl-badge">SkyBlock <span id="sb-lvl">1.00</span></div>
        <button class="top-btn" onclick="game.showModal('leadModal')">üèÜ –¢–æ–ø</button>
    </div>

    <div id="viewport">
        <!-- HOME -->
        <div id="home" class="screen active">
            <div class="card" style="text-align: center;">
                <h1 style="margin:0; color:var(--accent);">üí∞ <span id="coins">0</span></h1>
                <p style="color:var(--gray); font-size:0.8rem;">–ß–∏—Å—Ç—ã–µ –º–æ–Ω–µ—Ç—ã</p>
            </div>
            
            <div class="card">
                <div class="stat-grid">
                    <div>‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ: <span class="stat-val" id="st-hp">100</span></div>
                    <div>‚öîÔ∏è –°–∏–ª–∞: <span class="stat-val" id="st-str">10</span></div>
                    <div>üõ°Ô∏è –ë—Ä–æ–Ω—è: <span class="stat-val" id="st-def">0</span></div>
                    <div>üí• –ö—Ä–∏—Ç –®–∞–Ω—Å: <span class="stat-val" id="st-cc">0%</span></div>
                    <div>üî• –ö—Ä–∏—Ç –£—Ä–æ–Ω: <span class="stat-val" id="st-cd">50%</span></div>
                    <div>üçÄ –£–¥–∞—á–∞: <span class="stat-val" id="st-mf">0</span></div>
                </div>
            </div>

            <div class="card" id="active-effects">
                <small style="color:var(--gray)">–ê–∫—Ç–∏–≤–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</small>
            </div>
        </div>

        <!-- PORTAL -->
        <div id="portal" class="screen">
            <h3 style="text-align:center">üåÄ –ü–û–†–¢–ê–õ</h3>
            <div class="portal-container">
                <div class="portal-node" onclick="game.goLoc('mine')">‚õèÔ∏è –®–∞—Ö—Ç–∞</div>
                <div class="portal-node" onclick="game.goLoc('farm')">üåæ –§–µ—Ä–º–∞</div>
                <div class="portal-node" onclick="game.goLoc('fish')">üé£ –†—ã–±–∞–ª–∫–∞</div>
                <div class="portal-node" onclick="game.goLoc('combat')">‚öîÔ∏è –î–∞–Ω–∂–∏</div>
                <div class="portal-node" onclick="game.msg('–°–∫–æ—Ä–æ...')">üëπ –°–ª–µ–π–µ—Ä—ã</div>
                <div class="portal-node" onclick="game.msg('–°–∫–æ—Ä–æ...')">üõí –ú–∞–≥–∞–∑–∏–Ω</div>
                <div class="portal-node" onclick="game.msg('–°–∫–æ—Ä–æ...')">‚öñÔ∏è –û–±–º–µ–Ω</div>
                <div class="portal-node" onclick="game.msg('–°–∫–æ—Ä–æ...')">üó≥Ô∏è –ú—ç—Ä</div>
            </div>
        </div>

        <!-- GATHERING AREA (Generic for Mine/Farm/etc) -->
        <div id="action-loc" class="screen">
            <button class="top-btn" onclick="game.switchTab('portal')">‚Üê –ù–∞–∑–∞–¥</button>
            <h2 id="loc-name" style="text-align:center">–õ–æ–∫–∞—Ü–∏—è</h2>
            <div class="card" style="min-height: 150px; display: flex; flex-direction: column; justify-content: center; align-items: center;">
                <div id="loc-status" style="margin-bottom: 20px; font-weight: bold;">–ì–æ—Ç–æ–≤...</div>
                <button class="portal-node" style="width: 80%;" id="main-action-btn" onclick="game.doAction()">–î–ï–ô–°–¢–í–ò–ï</button>
            </div>
            <div id="loc-log" style="font-size: 0.8rem; color: var(--gray); text-align: center; padding: 10px;"></div>
        </div>

        <!-- MINIONS -->
        <div id="minions" class="screen">
            <h3>üë∑ –ú–ò–ù–¨–û–ù–´</h3>
            <div id="minions-container"></div>
        </div>

        <!-- INVENTORY -->
        <div id="inventory" class="screen">
            <div class="inv-cats">
                <button class="cat-btn active" onclick="game.filterInv('weapon', this)">–û—Ä—É–∂–∏–µ</button>
                <button class="cat-btn" onclick="game.filterInv('armor', this)">–ë—Ä–æ–Ω—è</button>
                <button class="cat-btn" onclick="game.filterInv('tool', this)">–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</button>
                <button class="cat-btn" onclick="game.filterInv('material', this)">–ú–∞—Ç–µ—Ä–∏–∞–ª—ã</button>
                <button class="cat-btn" onclick="game.filterInv('potion', this)">–ó–µ–ª—å—è</button>
            </div>
            <div id="inv-list"></div>
        </div>
    </div>

    <!-- MODALS -->
    <div id="skillsModal" class="modal">
        <span class="close-modal" onclick="game.closeModal('skillsModal')">[–ó–ê–ö–†–´–¢–¨]</span>
        <h3>üìä –í–ê–®–ò –ù–ê–í–´–ö–ò</h3>
        <div id="skills-list"></div>
    </div>

    <div id="leadModal" class="modal">
        <span class="close-modal" onclick="game.closeModal('leadModal')">[–ó–ê–ö–†–´–¢–¨]</span>
        <h3>üèÜ –¢–ê–ë–õ–ò–¶–ê –õ–ò–î–ï–†–û–í</h3>
        <div class="inv-cats">
            <button class="cat-btn active">üí∞ –ú–æ–Ω–µ—Ç—ã</button>
            <button class="cat-btn">‚≠ê LVL</button>
            <button class="cat-btn">‚öñÔ∏è –í–µ—Å</button>
        </div>
        <div style="margin-top:20px; color:var(--gray)">–í—ã: #1,241</div>
    </div>

    <nav id="nav">
        <button class="nav-item active" onclick="game.switchTab('home', this)"><i>üè†</i>–î–æ–º</button>
        <button class="nav-item" onclick="game.switchTab('portal', this)"><i>üåÄ</i>–ü–æ—Ä—Ç–∞–ª</button>
        <button class="nav-item" onclick="game.switchTab('minions', this)"><i>üë∑</i>–ú–∏–Ω—å–æ–Ω—ã</button>
        <button class="nav-item" onclick="game.switchTab('inventory', this)"><i>üéí</i>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
    </nav>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        const game = {
            state: {
                coins: 0,
                sbXP: 0,
                stats: { hp: 100, str: 10, def: 0, cc: 5, cd: 50, mf: 0 },
                skills: {
                    mining: { lvl: 1, xp: 0, next: 100, label: '–®–∞—Ö—Ç–∞' },
                    farming: { lvl: 1, xp: 0, next: 100, label: '–§–µ—Ä–º–∞' },
                    fishing: { lvl: 1, xp: 0, next: 100, label: '–†—ã–±–∞–ª–∫–∞' },
                    combat: { lvl: 1, xp: 0, next: 100, label: '–ë–æ–π' },
                    foraging: { lvl: 1, xp: 0, next: 100, label: '–õ–µ—Å–æ—Ä—É–±' }
                },
                minions: [
                    { id: 'wheat', name: '–ü—à–µ–Ω–∏—á–Ω—ã–π', lvl: 1, cost: 500, stored: 0, max: 64, rate: 0.1 },
                    { id: 'coal', name: '–£–≥–æ–ª—å–Ω—ã–π', lvl: 1, cost: 2500, stored: 0, max: 64, rate: 0.5 }
                ],
                inventory: [
                    { id: 1, name: '–°—Ç–∞—Ä—ã–π –º–µ—á', type: 'weapon', rarity: 0, stat: 5, equipped: false },
                    { id: 2, name: '–î–µ—Ä–µ–≤—è–Ω–Ω–∞—è –∫–∏—Ä–∫–∞', type: 'tool', rarity: 0, stat: 1, equipped: true }
                ]
            },

            currentLoc: null,

            init() {
                this.updateUI();
                this.startMinionLoop();
                console.log("Game Engine Ready");
            },

            updateUI() {
                document.getElementById('coins').innerText = Math.floor(this.state.coins).toLocaleString();
                document.getElementById('sb-lvl').innerText = (this.getTotalSkillLevels() * 10 / 100).toFixed(2);
                
                // Stats
                document.getElementById('st-hp').innerText = this.state.stats.hp;
                document.getElementById('st-str').innerText = this.state.stats.str;
                document.getElementById('st-def').innerText = this.state.stats.def;
                document.getElementById('st-cc').innerText = this.state.stats.cc + "%";
                document.getElementById('st-cd').innerText = this.state.stats.cd + "%";
                document.getElementById('st-mf').innerText = this.state.stats.mf;

                this.renderMinions();
                this.renderInventory();
            },

            getTotalSkillLevels() {
                return Object.values(this.state.skills).reduce((a, b) => a + b.lvl, 0);
            },

            switchTab(tabId, el) {
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                document.getElementById(tabId).classList.add('active');
                if(el) {
                    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                    el.classList.add('active');
                }
                tg.HapticFeedback.impactOccurred('light');
            },

            showModal(id) {
                if(id === 'skillsModal') this.renderSkills();
                document.getElementById(id).style.display = 'block';
            },

            closeModal(id) { document.getElementById(id).style.display = 'none'; },

            // --- SKILLS LOGIC ---
            renderSkills() {
                const list = document.getElementById('skills-list');
                list.innerHTML = '';
                for (const [key, s] of Object.entries(this.state.skills)) {
                    const perc = (s.xp / s.next) * 100;
                    list.innerHTML += `
                        <div class="card">
                            <div style="display:flex; justify-content:space-between">
                                <strong>${s.label} LVL ${s.lvl}</strong>
                                <small>${s.xp} / ${s.next} XP</small>
                            </div>
                            <div class="progress-wrap"><div class="progress-fill" style="width:${perc}%"></div></div>
                        </div>
                    `;
                }
            },

            addXP(skillKey, amount) {
                const s = this.state.skills[skillKey];
                s.xp += amount;
                if(s.xp >= s.next) {
                    s.xp -= s.next;
                    s.lvl++;
                    s.next = Math.floor(s.next * 1.6);
                    this.msg(`–£—Ä–æ–≤–µ–Ω—å –Ω–∞–≤—ã–∫–∞ ${s.label} –ø–æ–≤—ã—à–µ–Ω –¥–æ ${s.lvl}!`);
                    tg.HapticFeedback.notificationOccurred('success');
                }
                this.updateUI();
            },

            // --- LOCATIONS ---
            goLoc(loc) {
                this.currentLoc = loc;
                this.switchTab('action-loc');
                const names = { mine: '–ì–ª—É–±–æ–∫–∏–µ —à–∞—Ö—Ç—ã', farm: '–§–µ—Ä–º–µ—Ä—Å–∫–∏–µ –ø–æ–ª—è', fish: '–î–∏–∫–∏–π –æ–∫–µ–∞–Ω', combat: '–î–∞–Ω–∂ (–£—Ä. 1)' };
                document.getElementById('loc-name').innerText = names[loc];
                document.getElementById('loc-status').innerText = "–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ";
            },

            doAction() {
                const loc = this.currentLoc;
                let skillKey = 'combat';
                if(loc === 'mine') skillKey = 'mining';
                if(loc === 'farm') skillKey = 'farming';
                if(loc === 'fish') skillKey = 'fishing';

                const sLvl = this.state.skills[skillKey].lvl;
                
                // Tier Logic
                let tier = 1;
                if(sLvl >= 5) tier = 2;
                if(sLvl >= 25) tier = 3;
                if(sLvl >= 60) tier = 4;

                let reward = tier * 5;
                let xp = tier * 10;
                let find = "–û–±—ã—á–Ω—ã–π —Ä–µ—Å—É—Ä—Å";

                // Rare chance (0.001%)
                if(Math.random() < 0.0001) {
                    find = "‚ú® –ù–ï–í–ï–†–û–Ø–¢–ù–û –†–ï–î–ö–ò–ô –ü–†–ï–î–ú–ï–¢ ‚ú®";
                    reward *= 100;
                    xp *= 50;
                }

                this.state.coins += reward;
                this.addXP(skillKey, xp);
                document.getElementById('loc-log').innerHTML = `–î–æ–±—ã—Ç–æ: ${find} <br> –ü–æ–ª—É—á–µ–Ω–æ: +${reward} üí∞, +${xp} XP`;
                tg.HapticFeedback.impactOccurred('medium');
            },

            // --- MINIONS ---
            renderMinions() {
                const container = document.getElementById('minions-container');
                container.innerHTML = '';
                this.state.minions.forEach((m, i) => {
                    container.innerHTML += `
                        <div class="card">
                            <div style="display:flex; justify-content:space-between">
                                <strong>${m.name} I</strong>
                                <span>${Math.floor(m.stored)} / ${m.max}</span>
                            </div>
                            <div style="margin-top:10px">
                                <button class="top-btn" onclick="game.collectMinion(${i})">–°–æ–±—Ä–∞—Ç—å</button>
                                <button class="top-btn" onclick="game.buyMinion(${i})">–£–ª—É—á—à–∏—Ç—å (${m.cost} üí∞)</button>
                            </div>
                        </div>
                    `;
                });
            },

            collectMinion(i) {
                const m = this.state.minions[i];
                if(m.stored >= 1) {
                    const gain = Math.floor(m.stored) * 10;
                    this.state.coins += gain;
                    m.stored = 0;
                    this.updateUI();
                    tg.HapticFeedback.notificationOccurred('success');
                }
            },

            startMinionLoop() {
                setInterval(() => {
                    this.state.minions.forEach(m => {
                        if(m.stored < m.max) m.stored = Math.min(m.max, m.stored + m.rate);
                    });
                    if(document.getElementById('minions').classList.contains('active')) this.renderMinions();
                }, 1000);
            },

            // --- INVENTORY ---
            filterInv(type, btn) {
                document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                this.renderInventory(type);
            },

            renderInventory(filter = 'weapon') {
                const list = document.getElementById('inv-list');
                list.innerHTML = '';
                const items = this.state.inventory.filter(i => i.type === filter);
                
                if(items.length === 0) {
                    list.innerHTML = '<p style="text-align:center; color:#555">–ü—É—Å—Ç–æ...</p>';
                    return;
                }

                items.forEach(item => {
                    list.innerHTML += `
                        <div class="item-card" style="border-color: var(--rarity${item.rarity})">
                            <div>
                                <div style="color:var(--rarity${item.rarity})">${item.name}</div>
                                <small>${item.stat > 0 ? '+'+item.stat+' –°–∏–ª—ã' : ''}</small>
                            </div>
                            <div>
                                <button class="top-btn" onclick="game.invAction(${item.id})">${item.equipped ? '–°–Ω—è—Ç—å' : '–ù–∞–¥–µ—Ç—å'}</button>
                            </div>
                        </div>
                    `;
                });
            },

            invAction(id) {
                const item = this.state.inventory.find(i => i.id === id);
                item.equipped = !item.equipped;
                this.msg(item.equipped ? "–ü—Ä–µ–¥–º–µ—Ç –Ω–∞–¥–µ—Ç" : "–ü—Ä–µ–¥–º–µ—Ç —Å–Ω—è—Ç");
                this.updateUI();
            },

            msg(txt) {
                tg.showAlert(txt);
            }
        };

        game.init();
    </script>
</body>
</html>
